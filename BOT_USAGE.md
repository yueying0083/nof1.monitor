# Telegram Bot 使用说明

## 功能介绍

Telegram Bot 提供实时查询持仓报告的功能，支持：
- 查看所有监控模型的持仓情况
- 查看指定模型的持仓详情
- 实时获取最新数据

## 配置步骤

### 1. 编辑 `.env` 文件

在 `.env` 文件中添加以下配置：

```bash
# 你的用户 ID（从日志中获取，比如 5592645502）
TELEGRAM_ADMIN_IDS=5592645502
```

如果需要授权多个用户，用逗号分隔：
```bash
TELEGRAM_ADMIN_IDS=5592645502,123456789,987654321
```

### 2. 获取你的 Telegram 用户 ID

如果不知道自己的用户 ID，可以：
1. 在 Telegram 中搜索 `@userinfobot`
2. 发送 `/start` 给它
3. 它会回复你的用户 ID

### 3. 启动 Bot

有三种启动方式：

**方式 1：只启动 Bot（不启动监控）**
```bash
export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890
npm run bot
```

**方式 2：同时启动监控和 Bot**
```bash
export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890
npm run start:bot
```

**方式 3：只启动监控（不启动 Bot）**
```bash
export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890
npm start
```

## Bot 命令

在 Telegram 中与 Bot 私聊，使用以下命令：

### `/report` 或 `/position`
查看所有监控模型的持仓报告

**示例：**
```
/report
```

### `/report <模型名>`
查看指定模型的持仓报告

**示例：**
```
/report deepseek-chat-v3.1
/report qwen3-max
/report gpt-5
```

### `/help`
显示帮助信息

## 报告内容说明

Bot 返回的报告包含以下信息：

### 模型级别信息
- 🤖 模型名称
- 🔗 模型详情链接
- 💰 总资产
- 📈 已实现盈亏
- 💚/❤️ 浮动盈亏
- 📊 持仓数量
- 💵 现金金额和占比

### 每个持仓的信息
- 📈/📉 方向（多/空）+ 币种 + 杠杆倍数
- 持仓数量 + 名义价值
- 当前价格 + 涨跌幅
- 保证金占比 + 保证金金额
- 💚/❤️ 浮动盈亏

### 持仓排序
按保证金占比从高到低排序，优先显示占比最大的持仓。

## 注意事项

1. **权限控制**：只有配置在 `TELEGRAM_ADMIN_IDS` 中的用户才能使用 Bot 查询功能
2. **实时数据**：每次查询都会重新获取最新的持仓数据
3. **消息长度**：如果持仓过多，Bot 会自动简化报告
4. **代理设置**：在中国大陆使用需要设置代理才能访问 Telegram API

## 故障排查

### Bot 没有响应
- 检查 Bot 进程是否正常运行
- 检查网络代理设置是否正确
- 查看日志文件 `logs/trading_monitor.log`

### 提示"无权限访问"
- 检查 `.env` 文件中的 `TELEGRAM_ADMIN_IDS` 配置
- 确认使用的是正确的用户 ID（不是用户名）
- 重启 Bot 使配置生效

### 查询超时或失败
- 检查 API 接口是否正常
- 检查网络连接
- 查看日志了解详细错误信息

## 示例会话

```
你: /help
Bot: 📖 Bot 使用帮助
     
     可用命令：
     /report - 查看所有监控模型的持仓报告
     /report <模型名> - 查看指定模型的持仓报告
     /help - 显示此帮助信息
     
     示例：
     /report
     /report deepseek-chat-v3.1
     ...

你: /report qwen3-max
Bot: ⏳ 正在获取持仓数据，请稍候...

Bot: 📊 实时持仓报告
     
     ⏰ 时间: 2025-10-27 18:35:00
     🤖 模型数: 1
     
     ━━━━━━━━━━━━━━━━━
     🤖 qwen3-max
     🔗 https://nof1.ai/models/qwen3-max
     
     💰 总资产: $7972.26
     📈 已实现盈亏: $10007.07
     💚 浮动盈亏: +123.45
     
     📊 持仓数量: 1个
     💵 现金: $4685.04 (58.75%)
     
     📈 ETH 多 25x
        持仓: 22.6600 ($94462.34)
        价格: $4170.45 (+2.15%)
        占比: 41.25% (保证金 $3287.23)
        💚 浮盈: +123.45
     
     ━━━━━━━━━━━━━━━━━
```

