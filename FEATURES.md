# 功能说明

## 初始持仓报告

当监控系统启动后第一次执行监控任务时，会自动发送一份**初始持仓报告**，让你了解当前所有监控模型的持仓状态。

### 报告内容

初始持仓报告包含以下信息：

1. **基本信息**
   - 报告生成时间
   - 监控的模型数量

2. **每个模型的详细持仓**
   - 模型名称和链接
   - 持仓数量
   - 每个持仓的详细信息：
     - 交易对（如 BTC、ETH）
     - 方向（📈 多头 / 📉 空头）
     - 持仓数量
     - 杠杆倍数
     - 进入价格
     - 当前价格
     - 浮动盈亏（💚 盈利 / ❤️ 亏损）

### 报告示例

```
📊 初始持仓报告

⏰ 时间: 2025-10-27 18:00:00
🤖 监控模型数: 2

🤖 claude-sonnet-4-5 [查看](https://nof1.ai/models/claude-sonnet-4-5)
  📈 持仓数: 2
  📈 多 *BTC*
    数量: 0.5 | 杠杆: 10x
    进入: 65432.10 | 当前: 66100.50
    💚 浮盈: 334.20 USDT
  📈 多 *ETH*
    数量: 5.0 | 杠杆: 5x
    进入: 3200.00 | 当前: 3250.00
    💚 浮盈: 250.00 USDT

🤖 gpt-4o [查看](https://nof1.ai/models/gpt-4o)
  📈 持仓数: 1
  📉 空 *SOL*
    数量: 100 | 杠杆: 3x
    进入: 145.50 | 当前: 142.30
    💚 浮盈: 320.00 USDT

✅ 监控系统已启动，后续将监控持仓变化
```

### 特性说明

- **自动触发**: 系统启动后第一次运行时自动发送
- **模型过滤**: 如果配置了 `MONITORED_MODELS`，只显示指定模型的持仓
- **空持仓处理**: 如果模型暂无持仓，会显示"暂无持仓"
- **直观展示**: 使用 emoji 图标直观显示方向和盈亏状态

### 配置

无需额外配置，系统会在以下情况自动发送初始持仓报告：

1. 首次启动系统
2. 删除 `last.json` 后重启系统
3. 任何导致系统认为是"首次运行"的情况

### 禁用方法

如果不想收到初始持仓报告，可以在启动前创建一个空的 `last.json` 文件：

```bash
echo '{"positions":[]}' > last.json
```

## 交易变化通知

在初始持仓报告之后，系统会持续监控持仓变化，并在检测到以下情况时发送通知：

1. **新开仓**: 模型开立新的持仓
2. **平仓**: 模型关闭现有持仓
3. **加仓**: 增加现有持仓的数量
4. **减仓**: 减少现有持仓的数量
5. **调整杠杆**: 修改持仓的杠杆倍数
6. **新模型**: 新的模型开始交易
7. **模型停止**: 模型停止交易

### 通知示例

```
🚨 AI交易监控提醒
⏰ 时间: 2025-10-27 18:05:32
📊 检测到 1 个交易变化:

🤖 claude-sonnet-4-5 [查看持仓](https://nof1.ai/models/claude-sonnet-4-5)
  🟢 claude-sonnet-4-5 BTC 新开仓: 买多 0.5 (杠杆: 10x, 进入: 65432.10, 当前: 65450.00)
```

## 监控频率

- **检查间隔**: 每分钟检查一次
- **首次报告**: 启动后第一次检查（约1分钟后）
- **后续通知**: 仅在检测到变化时发送

## 日志记录

所有操作都会记录到日志文件：

```
logs/trading_monitor.log
```

可以通过日志查看：
- 系统启动时间
- 每次检查的结果
- 持仓变化详情
- 错误和警告信息

## 提示

1. **首次启动**: 建议删除旧的 `current.json` 和 `last.json`，让系统发送初始报告
2. **测试功能**: 使用 `npm run test` 测试 Telegram 通知是否正常
3. **查看日志**: 如果没有收到通知，检查日志文件排查问题
4. **持仓链接**: 点击模型名称后的"查看"链接可以直接跳转到 nof1.ai 查看详情

---

更多功能正在开发中，敬请期待！

